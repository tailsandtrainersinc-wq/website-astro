---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import EventCalendar from "../components/EventCalendar.tsx";
import { SITE } from "../config/site.mjs";

const entries = await getCollection("events");
const events = entries.map((entry) => ({
  id: entry.id,
  title: entry.data.title,
  description: entry.data.description,
  date: entry.data.date,
  endDate: entry.data.endDate ?? undefined,
  startTime: entry.data.startTime ?? undefined,
  endTime: entry.data.endTime ?? undefined,
  location: entry.data.location ?? undefined,
  tags: entry.data.tags ?? [],
  parentEvent: entry.data.parentEvent ?? undefined,
  body: entry.body ?? undefined,
}));
---

<Layout
  title={`Calendar | ${SITE.title}`}
  description="Upcoming events from Tails and Trainers. Workshops, meetups, and more."
  canonicalURL={`${SITE.url}/calendar`}
>
  <Header />
  <main id="main-content" role="main">
    <section class="max-w-6xl mx-auto px-6 md:px-12 pt-32" style="padding-bottom: var(--space-section);">
      <div class="mb-8 md:mb-10">
        <h1
          class="mb-2 leading-tight"
          style="font-family: var(--font-serif); font-size: var(--text-display); color: var(--text-primary);"
        >
          Events
        </h1>
        <p class="text-sm md:text-base" style="color: var(--text-secondary);">
          Cons, meetups, workshops, and community gatherings. Tap any event for details.
        </p>
      </div>
      <EventCalendar client:load events={events} />
    </section>
  </main>
  <Footer />
</Layout>
