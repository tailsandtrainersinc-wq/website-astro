---
import { getCollection } from "astro:content";
import ScrollReveal from "./ScrollReveal.tsx";
import { Icon } from "astro-icon/components";

const features = (await getCollection("features")).sort(
  (a, b) => (a.data.order ?? 0) - (b.data.order ?? 0)
);
const introCopy = "Our mission is built on education, inclusion, and community support for LGBTQ individuals and allies.";
---

<section id="features" class="max-w-6xl mx-auto px-6 md:px-12" style="padding-top: var(--space-section); padding-bottom: var(--space-section);">
  <ScrollReveal client:idle mode="emerge">
    <div class="mb-12 md:mb-16 max-w-2xl">
      <h2
        class="mb-4 leading-tight"
        style="font-family: var(--font-serif); font-size: var(--text-display); color: var(--text-primary);"
      >
        What We Do
      </h2>
      <p style="color: var(--text-secondary); font-size: var(--text-body);">
        {introCopy}
      </p>
    </div>
  </ScrollReveal>

  <!-- Constellation layout -->
  <div class="relative">
    <!-- SVG connector lines (desktop only) -->
    <svg class="absolute inset-0 w-full h-full pointer-events-none hidden md:block" aria-hidden="true" style="z-index: 0;">
      <line x1="33%" y1="15%" x2="66%" y2="15%" stroke="oklch(0.72 0.18 25 / 0.08)" stroke-width="1" stroke-dasharray="6 8" />
      <line x1="20%" y1="40%" x2="50%" y2="55%" stroke="oklch(0.70 0.12 280 / 0.08)" stroke-width="1" stroke-dasharray="6 8" />
      <line x1="80%" y1="35%" x2="50%" y2="55%" stroke="oklch(0.72 0.18 25 / 0.06)" stroke-width="1" stroke-dasharray="6 8" />
      <line x1="30%" y1="75%" x2="70%" y2="85%" stroke="oklch(0.70 0.12 280 / 0.06)" stroke-width="1" stroke-dasharray="6 8" />
    </svg>

    <ScrollReveal client:idle mode="cascade" staggerDelay={0.12}>
      {features.map((entry) => {
        const { title, description, icon } = entry.data;
        return (
          <a
            href={`/features/${entry.id}`}
            class="feature-card cursor-reactive block relative p-6 md:p-8 rounded-3xl border transition-all duration-500 group mb-4 md:mb-6"
            style="background: oklch(0.15 0.02 280 / 0.3); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); border-color: oklch(0.25 0.02 280 / 0.3);"
          >
            <div class="relative z-10 flex items-start gap-5">
              {/* Icon with glow */}
              <div
                class="shrink-0 w-14 h-14 rounded-2xl flex items-center justify-center transition-all duration-500"
                style="background: oklch(0.72 0.18 25 / 0.12); color: var(--accent-warm);"
              >
                <Icon name={icon} class="w-7 h-7" aria-hidden="true" />
              </div>

              <div class="flex-1 min-w-0">
                <h3
                  class="text-xl mb-2 transition-colors duration-300"
                  style="font-family: var(--font-serif); color: var(--text-primary);"
                >
                  {title}
                </h3>
                <p class="leading-relaxed" style="color: var(--text-secondary); font-size: var(--text-body);">
                  {description}
                </p>
              </div>

              {/* Arrow indicator */}
              <Icon
                name="tabler:arrow-right"
                class="w-5 h-5 shrink-0 mt-1 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300"
                style="color: var(--accent-warm);"
                aria-hidden="true"
              />
            </div>
          </a>
        );
      })}
    </ScrollReveal>
  </div>
</section>

<style>
  .feature-card:hover {
    transform: translateY(-4px);
    border-color: oklch(0.72 0.18 25 / 0.3) !important;
    box-shadow: 0 0 40px oklch(0.72 0.18 25 / 0.06);
  }

  .feature-card:hover div:first-child > div:first-child {
    background: oklch(0.72 0.18 25 / 0.2) !important;
    box-shadow: 0 0 30px oklch(0.72 0.18 25 / 0.15);
  }

  /* Staggered widths for constellation feel on desktop */
  @media (min-width: 768px) {
    .feature-card:nth-child(odd) {
      max-width: 85%;
    }
    .feature-card:nth-child(even) {
      max-width: 85%;
      margin-left: auto;
    }
    .feature-card:nth-child(3n) {
      max-width: 75%;
      margin-left: 12%;
    }
  }
</style>
